apply plugin: 'com.android.application'

android {
    compileSdkVersion 25
    buildToolsVersion "25.0.2"
    defaultConfig {
        applicationId "se.kantarsifo.mobileanalytics.sampleapp"
        minSdkVersion 9
        targetSdkVersion 25
        versionCode 2
        versionName "3.0"
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}

dependencies {
    compile fileTree(include: ['*.jar'], dir: 'libs')
    androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', {
        exclude group: 'com.android.support', module: 'support-annotations'
    })
    compile 'com.android.support:appcompat-v7:25.3.1'
    testCompile 'junit:junit:4.12'
    compile project(':libmobiletagging')
    compile 'com.squareup.picasso:picasso:2.5.2'
}

task copyAARToReleaseFolder() << {

    def path = project.rootDir.path + '/TNS-Sifo-Mobile-Analytics-SDK-3.0.0'
    def apkPath = project.rootDir.path + '/app/build/outputs/apk'


    println  "Project Name:   "+ project.name;
    def aarPath = project.rootDir.path + "/" + "libmobiletagging/build/outputs/aar"

    println  "aarPath :    "+ aarPath;
    mkdir(path)

    def documentationPath = path + "/Documentation"
    def frameworkPath = path + "/Framework"
    def samplePath = path + "/Sample"

    mkdir(documentationPath)
    mkdir(frameworkPath)
    mkdir(samplePath)

    copyAPKToReleaseFolder(apkPath,samplePath)

    copy {
        from(aarPath) {
            println("Will try to copy")
            include '*-release.aar'
        }
        into frameworkPath
    }
    /*
    println  "Root project:   "+ project.rootProject;
    println  "  rootDir:      "+ project.rootDir;
    println  "  projectDir:   "+ project.projectDir;
    println  "  project dir:  "+ System.getProperty("user.dir");

    System.setProperty( "user.dir", project.projectDir.toString())
    println  "  project dir:  "+ System.getProperty("user.dir");*/




}

def copyAPKToReleaseFolder(apkPath,samplePath){

    println  "apkPath :    "+ apkPath;
    println  "samplePath :    "+ samplePath;

    copy {
        from(apkPath) {
            println("Will try to copy")
            include '*-debug.apk'
        }
        into samplePath
    }

}


afterEvaluate {

    println("2 !!!!!!")

    copyAARToReleaseFolder.dependsOn assembleRelease
    copyAARToReleaseFolder.dependsOn assembleDebug

    assembleRelease.doLast {
        copyAARToReleaseFolder.execute()
    }

    assembleDebug.doLast {
        copyAARToReleaseFolder.execute()
    }
}

